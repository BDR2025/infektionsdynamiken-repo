<!doctype html>
<html lang="de" data-mode="school" data-page="repo" data-coach="ben">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UID-Explore · Vector Wheel Demo</title>

  <link rel="stylesheet" href="../css/tokens.css" />
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/layout.css" />
  <link rel="stylesheet" href="../css/components.css" />
  <link rel="stylesheet" href="../css/patterns.css" />
  <link rel="stylesheet" href="../css/pages.css" />
  <link rel="stylesheet" href="../css/landing.css" />

  <style>
    .demo-stage { display: grid; gap: 16px; }
    .chart-wrap { border-radius: 12px; border: 1px solid var(--border,#e5e7eb); background: var(--panel,#0b0f16); overflow: hidden; padding: 12px; }
    .vw-grid { display: grid; grid-template-columns: 1fr 280px; gap: 12px; align-items: start; }
    @media (max-width: 900px){ .vw-grid { grid-template-columns: 1fr; } }
    #vwCanvas { width: 100%; aspect-ratio: 1/1; display: block; background: #000; border-radius: 12px; }
    .vw-card { background: var(--panel,#151b24); color: var(--text,#e6e6e6); border-radius: 12px; padding: 12px; }
    .vw-controls { display:flex; gap:8px; margin-bottom:8px; }
    .vw-controls button { padding:8px 12px; border:0; border-radius:8px; background:#2d2d2f; color:#fff; cursor:pointer; }
    .vw-meta { font-size:.875rem; opacity:.85; display:grid; gap:4px; }
    .vw-kv { display:flex; gap:8px; flex-wrap:wrap; }
    .vw-pill { padding:2px 8px; border-radius:999px; background:#1f2733; }
  </style>
</head>
<body class="repo">
  <header class="landing-header" role="banner">
    <div class="container bar">
      <a class="brand" href="../index.html" aria-label="Infektionsdynamiken.de — Startseite">
        <div class="wordmark wordmark-long">
          <div class="brand-title">Infektionsdynamiken verstehen</div>
          <div class="brand-claim">Repository · transparent &amp; zugänglich</div>
        </div>
        <div class="wordmark wordmark-short">
          <div class="brand-title">Infektionsdynamiken.de</div>
          <div class="brand-claim">Repository</div>
        </div>
      </a>
      <nav class="landing-nav" aria-label="Hauptnavigation Repository">
        <div class="nav-links">
          <a href="../architektur.html">Architektur</a>
          <a href="../publikationen.html">Publikationen</a>
          <a href="../lehre.html">Lehre</a>
          <a href="https://infektionsdynamiken.de/#legal">Rechtliches</a>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <section class="section container">
      <article class="card pad">
        <span class="eyebrow">DEMO</span>
        <hr class="accent-line" />
        <h1>UID-Explore · State Vector Wheel (Standalone)</h1>
        <p class="lead">Eigenständige Demo ohne Imports. Ring zeigt S, I, R. Reff-Zeiger reagiert dynamisch. Play/Pause steuert die Fake-Simulation.</p>

        <div class="demo-stage">
          <div class="chart-wrap">
            <div class="vw-grid">
              <canvas id="vwCanvas" aria-label="State Vector Wheel"></canvas>
              <aside class="vw-card">
                <h3>Steuerung</h3>
                <div class="vw-controls">
                  <button id="btnPlay">Play</button>
                  <button id="btnPause">Pause</button>
                  <button id="btnReset">Reset</button>
                </div>
                <div class="vw-meta">
                  <div class="vw-kv">
                    <span class="vw-pill">t <span id="mT">0</span> d</span>
                    <span class="vw-pill">S <span id="mS">—</span></span>
                    <span class="vw-pill">I <span id="mI">—</span></span>
                    <span class="vw-pill">R <span id="mR">—</span></span>
                    <span class="vw-pill">R₀ <span id="mR0">3.0</span></span>
                    <span class="vw-pill">Rₑff <span id="mRe">—</span></span>
                  </div>
                  <small>Farben greifen Tokens, falls gesetzt. Sonst Default grün, rot, blau.</small>
                </div>
              </aside>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <footer class="landing-footer">
    <div class="container">
      <p class="muted">© CC BY 4.0 · Infektionsdynamiken – Repository (Preview). Keine Cookies.</p>
    </div>
  </footer>

  <script type="module">
    // ====== Farb-Tokens oder Fallbacks ======
    const root = getComputedStyle(document.documentElement);
    const COL_S = root.getPropertyValue("--c-s").trim() || "#22C55E";
    const COL_I = root.getPropertyValue("--c-i").trim() || "#EF4444";
    const COL_R = root.getPropertyValue("--c-r").trim() || "#3B82F6";
    const COL_BG = "#0b0f16";

    // ====== Canvas Setup (DPR-scharf) ======
    const cvs = document.getElementById("vwCanvas");
    const ctx = cvs.getContext("2d", { alpha:false });
    const resize = () => {
      const rect = cvs.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      cvs.width  = Math.round(rect.width  * dpr);
      cvs.height = Math.round(rect.height * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      draw(); // neu zeichnen
    };
    new ResizeObserver(resize).observe(cvs);

    // ====== Fake-SIR Serie ======
    function genSIR(L=200, beta=0.35, gamma=0.08, dt=1){
      const S = new Array(L), I = new Array(L), R = new Array(L);
      let s=0.999, i=0.001, r=0;
      for(let k=0;k<L;k++){
        S[k]=s; I[k]=i; R[k]=r;
        const ds = -beta*s*i*dt;
        const di = (beta*s*i - gamma*i)*dt;
        const dr =  gamma*i*dt;
        s = Math.max(0, s+ds);
        i = Math.max(0, i+di);
        r = Math.min(1, 1 - s - i);
      }
      return { S,I,R };
    }
    const L = 240;
    const beta = 0.6;            // passt zu R0 = beta/gamma
    const gamma = 0.2;
    const R0 = beta / gamma;     // 3.0
    const sim = genSIR(L, beta, gamma, 1);

    // ====== State + Controls ======
    let idx = 0, timer = 0;
    const $T = document.getElementById("mT");
    const $S = document.getElementById("mS");
    const $I = document.getElementById("mI");
    const $R = document.getElementById("mR");
    const $R0 = document.getElementById("mR0");
    const $Re = document.getElementById("mRe");
    $R0.textContent = R0.toFixed(1);

    document.getElementById("btnPlay").onclick = () => {
      clearInterval(timer);
      timer = setInterval(() => { idx = (idx+1)%L; draw(); }, 80);
    };
    document.getElementById("btnPause").onclick = () => clearInterval(timer);
    document.getElementById("btnReset").onclick = () => { clearInterval(timer); idx=0; draw(); };

    // ====== Zeichnen ======
    function draw(){
      // Werte
      const s = sim.S[idx], i = sim.I[idx], r = sim.R[idx];
      const Reff = R0 * s; // SIR: Reff = R0 * S(t)

      // Meta anzeigen
      $T.textContent = String(idx);
      $S.textContent = (s*100).toFixed(1)+" %";
      $I.textContent = (i*100).toFixed(1)+" %";
      $R.textContent = (r*100).toFixed(1)+" %";
      $Re.textContent = Reff.toFixed(2);

      // Geometrie
      const w = cvs.clientWidth, h = cvs.clientHeight;
      const cx = w/2, cy = h/2;
      const R_outer = Math.min(w,h)/2 - 12;
      const R_ring  = R_outer - 8;
      const ringWidth = Math.max(12, R_outer*0.08);

      // Hintergrund
      ctx.fillStyle = COL_BG;
      ctx.fillRect(0,0,w,h);

      // Kreis-Ringe
      const start = -Math.PI/2; // oben
      const aS = s*2*Math.PI;
      const aI = i*2*Math.PI;
      const aR = r*2*Math.PI;

      // Hilfsfunktion Segment
      const arcSeg = (color, a0, a1) => {
        ctx.beginPath();
        ctx.lineWidth = ringWidth;
        ctx.strokeStyle = color;
        ctx.arc(cx, cy, R_ring, a0, a1, false);
        ctx.stroke();
      };

      // Reihenfolge: S, I, R (durchlaufend)
      arcSeg(COL_S, start, start + aS);
      arcSeg(COL_I, start + aS, start + aS + aI);
      arcSeg(COL_R, start + aS + aI, start + aS + aI + aR);

      // Innenkreise (dezente Skala)
      ctx.beginPath();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "rgba(255,255,255,0.08)";
      ctx.arc(cx, cy, R_ring - ringWidth*0.7, 0, Math.PI*2);
      ctx.stroke();

      // Reff-Zeiger
      const angleRe = -Math.PI/2;  // Zeiger steht auf 12 Uhr, Länge kodiert Reff
      const lenRe = Math.min(1.0, Reff/2.5) * (R_ring - ringWidth*0.9);
      ctx.beginPath();
      ctx.lineWidth = 4;
      ctx.strokeStyle = Reff > 1.01 ? COL_I : (Reff < 0.99 ? COL_S : "#ffffff");
      ctx.moveTo(cx, cy);
      ctx.lineTo(cx + lenRe*Math.cos(angleRe), cy + lenRe*Math.sin(angleRe));
      ctx.stroke();

      // β- und γ-Zeiger (klein, grau)
      const betaAng = start + (beta/1.2)%1 * 2*Math.PI;
      const gammaAng = start + (gamma/0.5)%1 * 2*Math.PI;
      const smallLen = (R_ring - ringWidth) * 0.55;
      ctx.strokeStyle = "rgba(200,200,200,0.8)";
      ctx.lineWidth = 3;
      ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx + smallLen*Math.cos(betaAng),  cy + smallLen*Math.sin(betaAng)); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx + (smallLen*0.8)*Math.cos(gammaAng), cy + (smallLen*0.8)*Math.sin(gammaAng)); ctx.stroke();

      // Mitte: Zeit-Disc
      const discR = Math.max(26, Math.min(w,h)*0.08);
      ctx.beginPath();
      ctx.fillStyle = "rgba(0,0,0,0.6)";
      ctx.arc(cx, cy, discR, 0, Math.PI*2);
      ctx.fill();

      // Zeit-Text
      ctx.fillStyle = "#fff";
      ctx.font = "600 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(`t = ${idx.toFixed(0)} d`, cx, cy);
    }

    // Erste Größen setzen und zeichnen
    resize(); // triggert draw()
  </script>
</body>
</html>
